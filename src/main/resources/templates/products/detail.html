<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детали товара - Inventory Management System</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .product-header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        .stock-indicator {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
        }
        .stock-low {
            background-color: #ffcccc;
            color: #cc0000;
        }
        .stock-normal {
            background-color: #ccffcc;
            color: #006600;
        }
        .stock-high {
            background-color: #cce5ff;
            color: #0044cc;
        }
        .info-card {
            border-left: 4px solid #2575fc;
            background-color: #f8f9fa;
        }
        .price-card {
            border-left: 4px solid #28a745;
            background-color: #f8f9fa;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .transaction-history {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <!-- Хлебные крошки -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">Главная</a></li>
            <li class="breadcrumb-item"><a th:href="@{/products}">Товары</a></li>
            <li class="breadcrumb-item active" aria-current="page">Детали товара</li>
        </ol>
    </nav>

    <!-- Заголовок с информацией о товаре -->
    <div class="product-header">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 th:text="${product.name}">Название товара</h1>
                <p class="lead" th:text="${product.description}">Описание товара</p>
                <div class="d-flex align-items-center gap-3 mt-3">
                    <span class="badge bg-secondary fs-6" th:text="${product.category}">Категория</span>
                    <span class="badge bg-info fs-6" th:text="${product.sku}">SKU</span>
                    <span th:classappend="${product.quantity <= product.minStockLevel ? 'stock-low' :
                                              (product.quantity >= product.maxStockLevel ? 'stock-high' : 'stock-normal')}"
                          class="stock-indicator">
                            <i class="bi bi-box-seam"></i>
                            Остаток: <span th:text="${product.quantity}">0</span> ед.
                        </span>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <div class="action-buttons justify-content-end">
                    <a th:href="@{/products/{id}/edit(id=${product.id})}" class="btn btn-warning">
                        <i class="bi bi-pencil-square"></i> Редактировать
                    </a>
                    <a th:href="@{/products}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Назад
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Основная информация -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Основная информация</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="p-3 info-card">
                                <h6><i class="bi bi-geo-alt"></i> Местоположение</h6>
                                <p class="fs-5" th:text="${product.location}">Не указано</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="p-3 info-card">
                                <h6><i class="bi bi-person-badge"></i> Поставщик</h6>
                                <p class="fs-5" th:text="${product.supplier ?: 'Не указан'}">Не указан</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="p-3 price-card">
                                <h6><i class="bi bi-currency-dollar"></i> Цена закупки</h6>
                                <p class="fs-5" th:text="${'$' + #numbers.formatDecimal(product.purchasePrice, 1, 2)}">$0.00</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="p-3 price-card">
                                <h6><i class="bi bi-tag"></i> Цена продажи</h6>
                                <p class="fs-5" th:text="${'$' + #numbers.formatDecimal(product.sellingPrice, 1, 2)}">$0.00</p>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="p-3 price-card">
                                <h6><i class="bi bi-percent"></i> Маржа</h6>
                                <p class="fs-5" th:text="${#numbers.formatDecimal((product.sellingPrice - product.purchasePrice) / product.purchasePrice * 100, 1, 2) + '%'}">0%</p>
                            </div>
                        </div>
                    </div>

                    <!-- Уровни запаса -->
                    <div class="card mt-4">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="bi bi-graph-up"></i> Управление запасами</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-4">
                                    <div class="p-3">
                                        <h6>Минимальный уровень</h6>
                                        <div class="progress" style="height: 25px;">
                                            <div class="progress-bar bg-danger"
                                                 th:style="${'width: ' + (product.quantity <= product.minStockLevel ? '100' :
                                                     #numbers.formatDecimal(product.minStockLevel / product.maxStockLevel * 100, 1, 0)) + '%;'}">
                                            </div>
                                        </div>
                                        <p class="mt-2 fs-5" th:text="${product.minStockLevel}">0</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3">
                                        <h6>Текущий запас</h6>
                                        <div class="progress" style="height: 25px;">
                                            <div class="progress-bar"
                                                 th:classappend="${product.quantity <= product.minStockLevel ? 'bg-danger' :
                                                                      (product.quantity >= product.maxStockLevel ? 'bg-warning' : 'bg-success')}"
                                                 th:style="${'width: ' + #numbers.formatDecimal(product.quantity / product.maxStockLevel * 100, 1, 0) + '%;'}">
                                            </div>
                                        </div>
                                        <p class="mt-2 fs-5" th:text="${product.quantity}">0</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3">
                                        <h6>Максимальный уровень</h6>
                                        <div class="progress" style="height: 25px;">
                                            <div class="progress-bar bg-primary"
                                                 th:style="${'width: 100%;'}">
                                            </div>
                                        </div>
                                        <p class="mt-2 fs-5" th:text="${product.maxStockLevel}">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- История транзакций (заглушка - нужно реализовать отдельно) -->
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0"><i class="bi bi-clock-history"></i> История движения</h5>
                </div>
                <div class="card-body">
                    <div class="transaction-history">
                        <p class="text-muted">Для отображения истории транзакций требуется реализовать соответствующий сервис.</p>
                        <!-- Здесь будет таблица с историей транзакций -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Боковая панель с метаданными -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0"><i class="bi bi-card-checklist"></i> Метаданные</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-calendar-plus"></i> Создан</span>
                            <span th:text="${#temporals.format(product.createdAt, 'dd.MM.yyyy HH:mm')}">01.01.2023 00:00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-calendar-check"></i> Обновлен</span>
                            <span th:text="${#temporals.format(product.updatedAt, 'dd.MM.yyyy HH:mm')}">01.01.2023 00:00</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-box"></i> Всего на складе</span>
                            <span class="badge bg-primary rounded-pill" th:text="${product.quantity}">0</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-cash-stack"></i> Стоимость запаса</span>
                            <span th:text="${'$' + #numbers.formatDecimal(product.quantity * product.purchasePrice, 1, 2)}">$0.00</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Быстрые действия -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-lightning-charge"></i> Быстрые действия</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#addStockModal">
                            <i class="bi bi-plus-circle"></i> Добавить на склад
                        </button>
                        <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#removeStockModal">
                            <i class="bi bi-dash-circle"></i> Списать со склада
                        </button>
                        <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#adjustStockModal">
                            <i class="bi bi-arrow-left-right"></i> Корректировка
                        </button>
                        <a th:href="@{/products/{id}/delete(id=${product.id})}"
                           class="btn btn-outline-danger"
                           onclick="return confirm('Вы уверены, что хотите удалить этот товар?')">
                            <i class="bi bi-trash"></i> Удалить товар
                        </a>
                    </div>
                </div>
            </div>

            <!-- Статус запаса -->
            <div class="card">
                <div class="card-header"
                     th:classappend="${product.quantity <= product.minStockLevel ? 'bg-danger' :
                                          (product.quantity >= product.maxStockLevel ? 'bg-warning' : 'bg-success')}">
                    <h5 class="mb-0 text-white"><i class="bi bi-exclamation-triangle"></i> Статус запаса</h5>
                </div>
                <div class="card-body">
                    <div th:if="${product.quantity <= product.minStockLevel}" class="alert alert-danger">
                        <h6><i class="bi bi-exclamation-octagon"></i> ВНИМАНИЕ!</h6>
                        <p class="mb-0">Запас ниже минимального уровня. Необходимо пополнение.</p>
                    </div>
                    <div th:if="${product.quantity >= product.maxStockLevel}" class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle"></i> ПРЕДУПРЕЖДЕНИЕ</h6>
                        <p class="mb-0">Запас превышает максимальный уровень. Возможно переполнение склада.</p>
                    </div>
                    <div th:unless="${product.quantity <= product.minStockLevel or product.quantity >= product.maxStockLevel}"
                         class="alert alert-success">
                        <h6><i class="bi bi-check-circle"></i> НОРМА</h6>
                        <p class="mb-0">Запас находится в допустимых пределах.</p>
                    </div>

                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="bi bi-info-circle"></i>
                            Рекомендуемый заказ:
                            <span th:text="${product.maxStockLevel - product.quantity}">0</span> единиц
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальные окна для быстрых действий -->
<div class="modal fade" id="addStockModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Добавить на склад</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/products/{id}/add-stock(id=${product.id})}" method="post">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Количество для добавления</label>
                        <input type="number" class="form-control" name="quantity" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Причина</label>
                        <select class="form-select" name="reason" required>
                            <option value="PURCHASE">Закупка</option>
                            <option value="RETURN">Возврат</option>
                            <option value="ADJUSTMENT">Корректировка</option>
                            <option value="OTHER">Другое</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    <button type="submit" class="btn btn-success">Добавить</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Простая валидация для модальных окон
    document.addEventListener('DOMContentLoaded', function() {
        const modals = ['addStockModal', 'removeStockModal', 'adjustStockModal'];

        modals.forEach(modalId => {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.addEventListener('show.bs.modal', function() {
                    const inputs = this.querySelectorAll('input[type="number"]');
                    inputs.forEach(input => {
                        input.value = '';
                    });
                });
            }
        });
    });
</script>
</body>
</html>