<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить товар - Inventory System</title>

    <!-- Ваши стили -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<!-- Навигационная панель -->
<header class="navbar navbar-dark">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">
            <i class="fas fa-boxes-stacked"></i>
            <span>Inventory System</span>
        </a>

        <button class="navbar-toggler" id="navbarToggle" aria-label="Переключить навигацию">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Панель управления</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/products}">
                        <i class="fas fa-box"></i>
                        <span>Товары</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" th:href="@{/products/new}">
                        <i class="fas fa-plus-circle"></i>
                        <span>Новый товар</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/products/low-stock}">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Низкий запас</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/h2-console}" target="_blank">
                        <i class="fas fa-database"></i>
                        <span>База данных</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</header>

<!-- Основной контент -->
<main class="container py-5">
    <!-- Заголовок страницы -->
    <div class="mb-5">
        <h1 class="mb-3">
            <i class="fas fa-plus-circle text-primary me-2"></i>
            Добавить новый товар
        </h1>
        <p class="text-muted">
            Заполните форму ниже чтобы добавить новый товар в систему управления запасами
        </p>
    </div>

    <!-- Форма добавления товара -->
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-edit me-2"></i>
                        Информация о товаре
                    </h5>
                </div>

                <div class="card-body">
                    <form th:action="@{/products}"
                          th:object="${product}"
                          method="post"
                          class="needs-validation"
                          novalidate>

                        <!-- Основная информация -->
                        <div class="mb-4">
                            <h6 class="mb-3 text-muted">
                                <i class="fas fa-info-circle me-2"></i>
                                Основная информация
                            </h6>

                            <div class="row g-3">
                                <!-- Название товара -->
                                <div class="col-md-12">
                                    <label for="name" class="form-label">
                                        <i class="fas fa-tag me-1"></i>
                                        Название товара *
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           id="name"
                                           th:field="*{name}"
                                           required
                                           placeholder="Введите название товара">
                                    <div class="invalid-feedback">
                                        Пожалуйста, введите название товара.
                                    </div>
                                </div>

                                <!-- SKU (опционально) -->
                                <div class="col-md-6">
                                    <label for="sku" class="form-label">
                                        <i class="fas fa-barcode me-1"></i>
                                        SKU
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           id="sku"
                                           th:field="*{sku}"
                                           placeholder="Оставьте пустым для автогенерации">
                                    <div class="form-text">
                                        Уникальный код товара. Если оставить пустым, будет сгенерирован автоматически.
                                    </div>
                                </div>

                                <!-- Категория -->
                                <div class="col-md-6">
                                    <label for="category" class="form-label">
                                        <i class="fas fa-tags me-1"></i>
                                        Категория *
                                    </label>
                                    <select class="form-select"
                                            id="category"
                                            th:field="*{category}"
                                            required>
                                        <option value="" selected disabled>Выберите категорию</option>
                                        <option value="Electronics">Электроника</option>
                                        <option value="Clothing">Одежда</option>
                                        <option value="Food">Продукты</option>
                                        <option value="Books">Книги</option>
                                        <option value="Office Supplies">Канцелярия</option>
                                        <option value="Other">Другое</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Пожалуйста, выберите категорию.
                                    </div>
                                </div>

                                <!-- Описание -->
                                <div class="col-12">
                                    <label for="description" class="form-label">
                                        <i class="fas fa-align-left me-1"></i>
                                        Описание
                                    </label>
                                    <textarea class="form-control"
                                              id="description"
                                              th:field="*{description}"
                                              rows="3"
                                              placeholder="Дополнительная информация о товаре..."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Запасы и цены -->
                        <div class="mb-4">
                            <h6 class="mb-3 text-muted">
                                <i class="fas fa-boxes me-2"></i>
                                Управление запасами
                            </h6>

                            <div class="row g-3">
                                <!-- Текущее количество -->
                                <div class="col-md-4">
                                    <label for="quantity" class="form-label">
                                        <i class="fas fa-cubes me-1"></i>
                                        Количество *
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="quantity"
                                           th:field="*{quantity}"
                                           min="0"
                                           required
                                           placeholder="0">
                                    <div class="invalid-feedback">
                                        Пожалуйста, введите количество.
                                    </div>
                                </div>

                                <!-- Минимальный запас -->
                                <div class="col-md-4">
                                    <label for="minStockLevel" class="form-label">
                                        <i class="fas fa-exclamation-triangle me-1"></i>
                                        Минимальный запас *
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="minStockLevel"
                                           th:field="*{minStockLevel}"
                                           min="0"
                                           required
                                           placeholder="10">
                                    <div class="form-text">
                                        При достижении этого уровня будет уведомление.
                                    </div>
                                </div>

                                <!-- Максимальный запас -->
                                <div class="col-md-4">
                                    <label for="maxStockLevel" class="form-label">
                                        <i class="fas fa-chart-line me-1"></i>
                                        Максимальный запас *
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="maxStockLevel"
                                           th:field="*{maxStockLevel}"
                                           min="0"
                                           required
                                           placeholder="100">
                                </div>

                                <!-- Цена покупки -->
                                <div class="col-md-6">
                                    <label for="purchasePrice" class="form-label">
                                        <i class="fas fa-shopping-cart me-1"></i>
                                        Цена покупки *
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number"
                                               class="form-control"
                                               id="purchasePrice"
                                               th:field="*{purchasePrice}"
                                               step="0.01"
                                               min="0"
                                               required
                                               placeholder="0.00">
                                    </div>
                                    <div class="invalid-feedback">
                                        Пожалуйста, введите цену покупки.
                                    </div>
                                </div>

                                <!-- Цена продажи -->
                                <div class="col-md-6">
                                    <label for="sellingPrice" class="form-label">
                                        <i class="fas fa-dollar-sign me-1"></i>
                                        Цена продажи *
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number"
                                               class="form-control"
                                               id="sellingPrice"
                                               th:field="*{sellingPrice}"
                                               step="0.01"
                                               min="0"
                                               required
                                               placeholder="0.00">
                                    </div>
                                    <div class="invalid-feedback">
                                        Пожалуйста, введите цену продажи.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Дополнительная информация -->
                        <div class="mb-4">
                            <h6 class="mb-3 text-muted">
                                <i class="fas fa-info-circle me-2"></i>
                                Дополнительная информация
                            </h6>

                            <div class="row g-3">
                                <!-- Поставщик -->
                                <div class="col-md-6">
                                    <label for="supplier" class="form-label">
                                        <i class="fas fa-truck me-1"></i>
                                        Поставщик
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           id="supplier"
                                           th:field="*{supplier}"
                                           placeholder="Название поставщика">
                                </div>

                                <!-- Местоположение -->
                                <div class="col-md-6">
                                    <label for="location" class="form-label">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        Местоположение *
                                    </label>
                                    <input type="text"
                                           class="form-control"
                                           id="location"
                                           th:field="*{location}"
                                           required
                                           placeholder="Например: Склад А, Стеллаж 3">
                                    <div class="invalid-feedback">
                                        Пожалуйста, укажите местоположение.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Кнопки формы -->
                        <div class="d-flex justify-content-between mt-5">
                            <a th:href="@{/products}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>
                                Назад к списку
                            </a>

                            <div class="d-flex gap-2">
                                <button type="reset" class="btn btn-outline-danger">
                                    <i class="fas fa-undo me-2"></i>
                                    Сбросить
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>
                                    Сохранить товар
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Подсказки -->
            <div class="alert alert-info mt-4">
                <div class="d-flex">
                    <i class="fas fa-info-circle fa-2x me-3"></i>
                    <div>
                        <h5 class="alert-heading mb-2">Советы по заполнению</h5>
                        <ul class="mb-0">
                            <li>Поля отмеченные * являются обязательными</li>
                            <li>SKU будет автоматически сгенерирован если оставить поле пустым</li>
                            <li>Минимальный запас используется для уведомлений о низком уровне запасов</li>
                            <li>Цена продажи должна быть выше цены покупки для получения прибыли</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Футер -->
<footer class="footer mt-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-4">
                <div class="d-flex align-items-center gap-2">
                    <i class="fas fa-boxes-stacked"></i>
                    <span class="text-muted">Система управления запасами</span>
                </div>
            </div>
            <div class="col-md-4 text-center">
                <div class="text-muted">
                    &copy; 2024 Inventory Management System
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="text-muted">
                    <span class="me-3">Версия: 1.0.0</span>
                    <span>БД: H2</span>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Валидация формы -->
<script>
    // Мобильная навигация
    document.getElementById('navbarToggle')?.addEventListener('click', function() {
        const navbarCollapse = document.getElementById('navbarCollapse');
        navbarCollapse.classList.toggle('show');
    });

    // Закрыть меню при клике вне его
    document.addEventListener('click', function(event) {
        const navbarCollapse = document.getElementById('navbarCollapse');
        const navbarToggle = document.getElementById('navbarToggle');

        if (navbarCollapse && navbarCollapse.classList.contains('show') &&
            !navbarCollapse.contains(event.target) &&
            !navbarToggle.contains(event.target)) {
            navbarCollapse.classList.remove('show');
        }
    });

    // Валидация формы Bootstrap
    (function () {
        'use strict'

        // Получить все формы, которые требуют проверки
        var forms = document.querySelectorAll('.needs-validation')

        // Цикл по формам и предотвращение отправки
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false)
            })
    })()

    // Проверка цен
    document.getElementById('sellingPrice')?.addEventListener('change', function() {
        const purchasePrice = document.getElementById('purchasePrice').value;
        const sellingPrice = this.value;

        if (parseFloat(sellingPrice) < parseFloat(purchasePrice)) {
            this.classList.add('is-invalid');
            const nextElementSibling = this.nextElementSibling?.nextElementSibling;
            if (nextElementSibling) {
                nextElementSibling.textContent = 'Цена продажи должна быть выше цены покупки';
            }
        } else {
            this.classList.remove('is-invalid');
        }
    });

    // Автоматический расчет прибыли
    document.getElementById('purchasePrice')?.addEventListener('input', updateProfit);
    document.getElementById('sellingPrice')?.addEventListener('input', updateProfit);

    function updateProfit() {
        const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
        const sellingPrice = parseFloat(document.getElementById('sellingPrice').value) || 0;

        if (purchasePrice > 0 && sellingPrice > 0) {
            const profit = sellingPrice - purchasePrice;
            const margin = (profit / purchasePrice * 100).toFixed(1);

            const profitElement = document.getElementById('profitInfo');
            if (!profitElement) {
                const profitDiv = document.createElement('div');
                profitDiv.id = 'profitInfo';
                profitDiv.className = 'form-text text-success mt-2';
                document.getElementById('sellingPrice').parentNode.appendChild(profitDiv);
            }

            document.getElementById('profitInfo').textContent =
                `Прибыль: $${profit.toFixed(2)} (${margin}% маржа)`;
        }
    }
</script>

<!-- Дополнительные стили -->
<style>
    .navbar-dark {
        background-color: #2c3e50;
    }

    .navbar-nav .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
    }

    .navbar-nav .nav-link:hover,
    .navbar-nav .nav-link.active {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .footer {
        background-color: #f8f9fa;
        padding: 2rem 0;
        margin-top: 3rem;
        border-top: 1px solid #dee2e6;
    }

    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    .form-text {
        font-size: 0.875rem;
        color: #6c757d;
    }

    .card {
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }

    .alert-info {
        border-left: 4px solid #17a2b8;
    }

    input:focus, select:focus, textarea:focus {
        border-color: #86b7fe;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .was-validated .form-control:valid {
        border-color: #198754;
    }

    .was-validated .form-control:invalid {
        border-color: #dc3545;
    }
</style>
</body>
</html>